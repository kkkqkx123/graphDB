# 模块清理分析报告

## 项目定位

轻量级、单节点图数据库，面向个人使用和小规模应用。

## 分析结果

### 1. 用户管理和权限系统

**位置**: `src/query/executor/admin/user/`, `src/api/service/permission_manager.rs`

**问题描述**:
- 对于单节点、个人使用的图数据库，完整的用户管理和RBAC权限系统过于复杂
- 实现了创建用户、修改密码、角色授权等功能，但这些功能在多用户场景下才有价值

**当前实现**:
- CreateUserExecutor - 创建用户
- AlterUserExecutor - 修改用户
- DropUserExecutor - 删除用户
- ChangePasswordExecutor - 修改密码
- GrantRoleExecutor - 授权角色
- RevokeRoleExecutor - 撤销角色
- PermissionManager - 权限管理

**建议方案**:
- 方案A: 完全移除用户管理模块，使用单用户模式
- 方案B: 保留简单的认证机制（如仅保留密码验证），移除RBAC角色系统
- 方案C: 保留当前实现（如果未来可能扩展为多用户）

**推荐**: 方案B - 保留简单认证，移除复杂权限系统

---

### 2. 查询管理模块

**位置**: `src/query/executor/admin/query_management/`

**问题描述**:
- SHOW QUERIES、KILL QUERY等多用户环境下的查询管理功能
- 对于单用户场景，这些功能价值有限

**当前实现**:
- ShowQueriesExecutor - 显示正在运行的查询
- KillQueryExecutor - 终止查询
- ShowStatsExecutor - 显示统计信息

**建议方案**:
- 方案A: 完全移除查询管理模块
- 方案B: 仅保留ShowStatsExecutor用于性能监控
- 方案C: 保留当前实现

**推荐**: 方案B - 保留统计功能，移除查询管理

---

### 3. 事务模块

**位置**: `src/storage/transaction/`

**问题描述**:
- 虽然事务是核心功能，但当前MVCC实现有大量TODO和未完善的部分
- 29个TODO/FIXME标记，包括WAL、MVCC、快照隔离等

**当前实现**:
- MVCC多版本并发控制
- WAL预写日志
- 快照隔离
- 版本链维护
- 垃圾回收

**建议方案**:
- 方案A: 简化为简单的读写锁机制（适合单节点低并发场景）
- 方案B: 保留当前框架，逐步实现完整MVCC
- 方案C: 使用现有的成熟事务库

**推荐**: 方案A - 简化事务实现，降低复杂度

---

### 4. 算法服务模块

**位置**: `src/services/algorithm/`

**问题描述**:
- 包含大量通用算法（排序、字符串处理等），与图数据库核心功能关联不大
- 这些算法可以直接使用Rust标准库或第三方库

**当前实现**:
- GraphAlgorithms - 图算法（BFS等）
- SearchAlgorithms - 搜索算法
- SortingAlgorithms - 排序算法
- StringAlgorithms - 字符串算法

**建议方案**:
- 方案A: 完全移除算法服务模块，直接使用标准库
- 方案B: 仅保留GraphAlgorithms（与图数据库相关）
- 方案C: 保留当前实现

**推荐**: 方案B - 仅保留图相关算法

---

### 5. 统计服务

**位置**: `src/services/stats.rs`

**问题描述**:
- 有TODO标记，实现不完整
- 对于轻量级数据库，详细的性能统计可能不是必需的

**建议方案**:
- 方案A: 移除统计服务
- 方案B: 简化统计功能，仅保留关键指标
- 方案C: 完善当前实现

**推荐**: 方案B - 简化统计功能

---

### 6. 会话管理

**位置**: `src/services/session.rs`, `src/api/session/`

**问题描述**:
- 有TODO标记，实现不完整
- 对于单节点数据库，复杂的会话管理可能不是必需的

**建议方案**:
- 方案A: 简化会话管理，使用简单的连接管理
- 方案B: 保留当前框架，逐步完善
- 方案C: 完全移除会话层

**推荐**: 方案A - 简化会话管理

---

## 实施优先级

### 高优先级（建议立即处理）
1. **算法服务模块** - 与核心功能无关，易于移除
2. **用户管理RBAC** - 对于单用户场景过于复杂

### 中优先级（建议后续处理）
3. **查询管理模块** - 部分功能有价值
4. **统计服务** - 需要评估实际需求

### 低优先级（谨慎处理）
5. **事务模块** - 涉及核心功能，需要仔细设计替代方案
6. **会话管理** - 与API层紧密相关，需要整体考虑

---

## 预期收益

1. **减少代码量**: 预计可减少约15-20%的代码
2. **降低复杂度**: 减少维护负担和潜在bug
3. **提高构建速度**: 减少编译单元
4. **聚焦核心**: 更专注于图数据库核心功能

---

## 风险评估

1. **向后兼容性**: 清理后可能需要修改配置文件或API调用
2. **功能回退**: 如果未来需要多用户支持，需要重新实现
3. **测试覆盖**: 需要确保清理后核心功能测试完整

---

*分析日期: 2026-02-14*
