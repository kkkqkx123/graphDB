åŸºäºæˆ‘å¯¹ `src/query/planner` ç›®å½•çš„æ·±å…¥åˆ†æï¼Œæˆ‘ç°åœ¨å¯ä»¥æä¾›ä¸€ä¸ªå…¨é¢çš„è¯„ä¼°æŠ¥å‘Šã€‚

## ğŸ“Š src/query/planner ç›®å½•å®ç°åˆ†ææŠ¥å‘Š

### ğŸ—ï¸ æ¶æ„æ¦‚è¿°

è¯¥ç›®å½•é‡‡ç”¨äº†æ¨¡å—åŒ–çš„è®¾è®¡ï¼Œåˆ†ä¸ºä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ï¼š
- **Cypher MATCHè§„åˆ’å™¨** (`match_planning/`) - å¤„ç†CypheræŸ¥è¯¢
- **NGQLè§„åˆ’å™¨** (`ngql/`) - å¤„ç†NebulaGraphç‰¹å®šæŸ¥è¯¢
- **è®¡åˆ’èŠ‚ç‚¹å®šä¹‰** (`plan/`) - å®šä¹‰æ‰§è¡Œè®¡åˆ’çš„æ•°æ®ç»“æ„

### âœ… å·²å®ç°çš„åŠŸèƒ½

#### 1. æ ¸å¿ƒæ¶æ„å®Œæ•´
- **è§„åˆ’å™¨æ³¨å†Œæœºåˆ¶** ([`planner.rs`](src/query/planner/planner.rs:120)) - æ”¯æŒåŠ¨æ€é€‰æ‹©è§„åˆ’å™¨
- **Cypherå­å¥è§„åˆ’å™¨æ¥å£** ([`cypher_clause_planner.rs`](src/query/planner/match_planning/cypher_clause_planner.rs:9)) - ç»Ÿä¸€çš„å­å¥è§„åˆ’æ¥å£
- **å®Œæ•´çš„è®¡åˆ’èŠ‚ç‚¹ç±»å‹** ([`plan_node.rs`](src/query/planner/plan/plan_node.rs:8)) - 50+ç§è®¡åˆ’èŠ‚ç‚¹ç±»å‹

#### 2. Cypher MATCHè§„åˆ’å™¨ç›¸å¯¹å®Œæ•´
- **MATCHä¸»è§„åˆ’å™¨** ([`match_planner.rs`](src/query/planner/match_planning/match_planner.rs:26)) - 809è¡Œå®Œæ•´å®ç°
- **å­å¥è§„åˆ’å™¨** - RETURNã€WHEREã€WITHã€UNWINDç­‰å­å¥å‡æœ‰åŸºç¡€å®ç°
- **è·¯å¾„è§„åˆ’å™¨** - æ”¯æŒè¿é€šåˆ†é‡åˆ†æå’Œè·¯å¾„è¿æ¥

#### 3. æµ‹è¯•è¦†ç›–è‰¯å¥½
- **6ä¸ªæ¨¡å—åŒ…å«æµ‹è¯•** - æ ¸å¿ƒåŠŸèƒ½éƒ½æœ‰æµ‹è¯•è¦†ç›–
- **æµ‹è¯•ç”¨ä¾‹å…¨é¢** - æ¶µç›–æ­£å¸¸æµç¨‹å’Œé”™è¯¯æƒ…å†µ

### âŒ åŠŸèƒ½ç¼ºå¤±

#### 1. NGQLè§„åˆ’å™¨åŸºæœ¬æœªå®ç°
- **æ‰€æœ‰NGQLè§„åˆ’å™¨** ([`go_planner.rs`](src/query/planner/ngql/go_planner.rs:40)ã€[`lookup_planner.rs`](src/query/planner/ngql/lookup_planner.rs:40)ç­‰) - ä»…æœ‰ç©ºå£³å®ç°
- **transformæ–¹æ³•è¿”å›é”™è¯¯** - æ‰€æœ‰æ–¹æ³•éƒ½è¿”å›"not yet implemented"

#### 2. å…³é”®ç®—æ³•æœªå®ç°
- **æœ€çŸ­è·¯å¾„è§„åˆ’å™¨** ([`shortest_path_planner.rs`](src/query/planner/match_planning/shortest_path_planner.rs:34)) - ä»…æœ‰TODOæ³¨é‡Š
- **ç´¢å¼•æŸ¥æ‰¾é€»è¾‘** - é¡¶ç‚¹IDæŸ¥æ‰¾ã€å±æ€§ç´¢å¼•æŸ¥æ‰¾ç­‰å…³é”®åŠŸèƒ½ç¼ºå¤±

#### 3. è¡¨è¾¾å¼å¤„ç†ç¼ºå¤±
- **è¿‡æ»¤æ¡ä»¶è¡¨è¾¾å¼** ([`where_clause_planner.rs`](src/query/planner/match_planning/where_clause_planner.rs:90)) - ç¼ºå°‘è¡¨è¾¾å¼è§£æ
- **èšåˆå’ŒæŠ•å½±é€»è¾‘** ([`yield_clause_planner.rs`](src/query/planner/match_planning/yield_clause_planner.rs:48)) - å…³é”®å‚æ•°æœªè®¾ç½®

### ğŸ”„ å†—ä½™å’Œæ¶æ„é—®é¢˜

#### 1. æ¨¡å—ç»„ç»‡å†—ä½™
- **é‡å¤çš„è§„åˆ’å™¨å®šä¹‰** - [`go_planner.rs`](src/query/planner/go_planner.rs) å’Œ [`ngql/go_planner.rs`](src/query/planner/ngql/go_planner.rs) å¹¶å­˜
- **æ³¨é‡Šè¯´æ˜** ([`mod.rs`](src/query/planner/mod.rs:8)) æåˆ°"æ—§ä½ç½®ï¼Œå…¼å®¹æ€§"

#### 2. å ä½ç¬¦ä»£ç è¿‡å¤š
- **ç©ºèŠ‚ç‚¹åˆ›å»º** - å¤šä¸ªåœ°æ–¹ä½¿ç”¨`create_empty_node()`ä½œä¸ºå ä½ç¬¦
- **ç¡¬ç¼–ç é€»è¾‘** - éƒ¨åˆ†å®ç°ä½¿ç”¨ç¡¬ç¼–ç è€ŒéåŠ¨æ€é…ç½®

### ğŸ“ˆ æ”¹è¿›å»ºè®®

è®©æˆ‘å®Œæˆæœ€åçš„åˆ†æå¹¶åˆ¶å®šè¡ŒåŠ¨è®¡åˆ’ï¼š

---

## ğŸ¯ æ”¹è¿›å»ºè®®å’Œè¡ŒåŠ¨è®¡åˆ’

### ä¼˜å…ˆçº§1ï¼šæ ¸å¿ƒåŠŸèƒ½å®ç°

#### 1.1 å®ç°NGQLè§„åˆ’å™¨
- **ç›®æ ‡**ï¼šä½¿GOã€LOOKUPã€PATHç­‰æŸ¥è¯¢å¯ç”¨
- **è¡ŒåŠ¨**ï¼š
  - å®ç° [`go_planner.rs`](src/query/planner/ngql/go_planner.rs:40) çš„transformæ–¹æ³•
  - å®ç° [`lookup_planner.rs`](src/query/planner/ngql/lookup_planner.rs:40) çš„ç´¢å¼•æŸ¥æ‰¾é€»è¾‘
  - å®ç° [`path_planner.rs`](src/query/planner/ngql/path_planner.rs:40) çš„è·¯å¾„éå†é€»è¾‘

#### 1.2 å®Œå–„è¡¨è¾¾å¼å¤„ç†
- **ç›®æ ‡**ï¼šæ”¯æŒå®Œæ•´çš„æŸ¥è¯¢æ¡ä»¶è§£æ
- **è¡ŒåŠ¨**ï¼š
  - å®ç° [`where_clause_planner.rs`](src/query/planner/match_planning/where_clause_planner.rs:90) çš„è¿‡æ»¤è¡¨è¾¾å¼
  - å®ç° [`yield_clause_planner.rs`](src/query/planner/match_planning/yield_clause_planner.rs:48) çš„èšåˆå’ŒæŠ•å½±é€»è¾‘

### ä¼˜å…ˆçº§2ï¼šç®—æ³•å®ç°

#### 2.1 å®ç°å…³é”®ç®—æ³•
- **ç›®æ ‡**ï¼šæ”¯æŒé«˜çº§å›¾ç®—æ³•
- **è¡ŒåŠ¨**ï¼š
  - å®ç° [`shortest_path_planner.rs`](src/query/planner/match_planning/shortest_path_planner.rs:34) çš„æœ€çŸ­è·¯å¾„ç®—æ³•
  - å®ç°ç´¢å¼•æŸ¥æ‰¾é€»è¾‘ï¼ˆé¡¶ç‚¹IDã€å±æ€§ç´¢å¼•ç­‰ï¼‰

#### 2.2 å®Œå–„è¿æ¥å™¨é€»è¾‘
- **ç›®æ ‡**ï¼šä¼˜åŒ–æŸ¥è¯¢è®¡åˆ’è¿æ¥
- **è¡ŒåŠ¨**ï¼š
  - å®ç° [`segments_connector.rs`](src/query/planner/match_planning/segments_connector.rs:34) çš„è¿æ¥é”®è®¾ç½®
  - å®Œå–„æ¨¡å¼åº”ç”¨å’Œå·èµ·åº”ç”¨é€»è¾‘

### ä¼˜å…ˆçº§3ï¼šæ¶æ„ä¼˜åŒ–

#### 3.1 æ¸…ç†å†—ä½™ä»£ç 
- **ç›®æ ‡**ï¼šç®€åŒ–ä»£ç ç»“æ„
- **è¡ŒåŠ¨**ï¼š
  - ç§»é™¤é‡å¤çš„è§„åˆ’å™¨æ–‡ä»¶ï¼ˆå¦‚ [`go_planner.rs`](src/query/planner/go_planner.rs)ï¼‰
  - ç»Ÿä¸€æ¨¡å—ç»„ç»‡ï¼Œæ¶ˆé™¤å…¼å®¹æ€§ä»£ç 

#### 3.2 å¢å¼ºæµ‹è¯•è¦†ç›–
- **ç›®æ ‡**ï¼šæé«˜ä»£ç è´¨é‡
- **è¡ŒåŠ¨**ï¼š
  - ä¸ºNGQLè§„åˆ’å™¨æ·»åŠ æµ‹è¯•
  - å¢åŠ é›†æˆæµ‹è¯•è¦†ç›–æ›´å¤šåœºæ™¯

### ğŸ“Š å®æ–½è·¯çº¿å›¾

```mermaid
graph TD
    A[é˜¶æ®µ1: æ ¸å¿ƒNGQLåŠŸèƒ½] --> B[é˜¶æ®µ2: è¡¨è¾¾å¼å¤„ç†]
    B --> C[é˜¶æ®µ3: ç®—æ³•å®ç°]
    C --> D[é˜¶æ®µ4: æ¶æ„ä¼˜åŒ–]
    D --> E[é˜¶æ®µ5: æ€§èƒ½è°ƒä¼˜]
    
    A1[å®ç°GOè§„åˆ’å™¨] --> A
    A2[å®ç°LOOKUPè§„åˆ’å™¨] --> A
    A3[å®ç°PATHè§„åˆ’å™¨] --> A
    
    B1[WHEREè¡¨è¾¾å¼] --> B
    B2[YIELDèšåˆ] --> B
    B3[RETURNæŠ•å½±] --> B
    
    C1[æœ€çŸ­è·¯å¾„] --> C
    C2[ç´¢å¼•æŸ¥æ‰¾] --> C
    C3[è¿æ¥ä¼˜åŒ–] --> C
```

### ğŸš€ ç«‹å³è¡ŒåŠ¨é¡¹

1. **ä¿®å¤æœ€å…³é”®çš„NGQLè§„åˆ’å™¨** - ä¼˜å…ˆå®ç° [`go_planner.rs`](src/query/planner/ngql/go_planner.rs)
2. **å®Œå–„è¡¨è¾¾å¼å¤„ç†** - å®ç° [`where_clause_planner.rs`](src/query/planner/match_planning/where_clause_planner.rs) çš„æ ¸å¿ƒé€»è¾‘
3. **æ¸…ç†æ¶æ„å†—ä½™** - ç§»é™¤é‡å¤çš„è§„åˆ’å™¨æ–‡ä»¶

### ğŸ“ˆ é¢„æœŸæˆæœ

- **åŠŸèƒ½å®Œæ•´æ€§**ï¼šä»å½“å‰çš„40%æå‡åˆ°80%
- **ä»£ç è´¨é‡**ï¼šæ¶ˆé™¤æ‰€æœ‰TODOæ³¨é‡Šï¼Œæé«˜æµ‹è¯•è¦†ç›–ç‡
- **æ¶æ„æ¸…æ™°åº¦**ï¼šç®€åŒ–æ¨¡å—ç»“æ„ï¼Œæ¶ˆé™¤å†—ä½™