# Query模块职责重叠问题总结

## 主要重叠问题

### 1. 上下文管理重叠
- **涉及模块**: `context/validate/` 和 `validator/`
- **重叠内容**: 验证上下文定义、变量管理、错误管理
- **影响**: 代码重复，维护成本高，可能导致不一致的验证行为

### 2. 执行计划重复定义
- **涉及模块**: `planner/plan/` 和 `scheduler/execution_plan.rs`
- **重叠内容**: ExecutionPlan定义和相关功能
- **影响**: 可能导致执行计划传递问题，增加维护成本

### 3. 表达式处理分散
- **涉及模块**: `parser`、`validator`、`visitor`、`executor`
- **重叠内容**: 表达式解析、验证、分析、转换、求值
- **影响**: 逻辑分散，难以统一管理，可能导致不一致性

### 4. 类型系统重复实现
- **涉及模块**: `validator` 和 `visitor/deduce_type_visitor.rs`
- **重叠内容**: 类型检查和推导逻辑
- **影响**: 类型处理逻辑分散，难以维护，可能导致不一致性

### 5. 错误处理不一致
- **涉及模块**: 所有模块
- **重叠内容**: 各自的错误类型和处理机制
- **影响**: 错误处理不统一，错误信息格式不一致

## 优化方向

1. **统一上下文管理**: 将验证上下文集中到`context/validate/`
2. **统一执行计划**: 将执行计划定义集中到`planner/plan/`
3. **集中表达式处理**: 创建独立的`expression`模块
4. **统一类型系统**: 创建独立的`type_system`模块
5. **统一错误处理**: 创建统一的错误类型体系

## 优先级建议

1. **高优先级**: 统一上下文管理、统一错误处理
2. **中优先级**: 统一执行计划、统一类型系统
3. **低优先级**: 集中表达式处理（涉及面广，需要谨慎规划）

## 注意事项

- `context`、`executor`、`optimizer`、`parser`、`planner`、`validator`模块已比较完善，不建议进行破坏性修改
- `scheduler`、`visitor`模块可以考虑破坏性修改以解决重叠问题
- 重构应分阶段进行，避免一次性大规模修改