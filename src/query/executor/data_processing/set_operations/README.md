# 集合运算执行器模块

本目录包含所有集合运算相关的执行器实现，用于处理数据集之间的集合操作。

## 文件说明

### 1. mod.rs

这是集合运算执行器模块的入口文件，定义了公共接口和可导出的类型。它包含了：

- **模块声明**：声明了 `base`、`union`、`union_all`、`intersect` 和 `minus` 子模块
- **公共类型导出**：导出了各种集合运算执行器类型
- **功能分类**：将集合操作分为 Union（并集去重）、UnionAll（并集保留重复）、Intersect（交集）和 Minus（差集）

### 2. base.rs

实现了集合操作执行器的基类，提供所有集合操作的通用功能，包括：

- **SetExecutor 基类**：所有集合操作执行器的基类，包含输入变量名、列名等公共属性
- **数据集获取**：提供了获取左右输入数据集的方法
- **输入验证**：实现了验证两个输入数据集列名是否一致的方法
- **哈希工具**：提供了创建行哈希值、行集合、去重等功能
- **数据集合并**：提供了合并两个数据集行的方法
- **抽象执行**：作为抽象基类，不能直接执行，由子类实现具体逻辑
- **单元测试**：验证哈希、去重、合并等基础功能

### 3. union.rs

实现了 UNION 操作，合并两个数据集并去除重复行，包括：

- **UnionExecutor**：UNION 执行器，实现 SQL UNION 类似的功能（不包括 UNION ALL）
- **去重逻辑**：合并数据集后去除重复行，使用哈希方法进行去重
- **错误处理**：验证输入数据集列名是否匹配，处理各种边界情况
- **执行流程**：获取输入数据集 → 验证列名 → 合并 → 去重 → 返回结果
- **单元测试**：验证基本功能、空数据集处理和列名不匹配错误

### 4. union_all.rs

实现了 UNION ALL 操作，合并两个数据集但保留重复行，包括：

- **UnionAllExecutor**：UNION ALL 执行器，实现 SQL UNION ALL 类似的功能
- **保留重复**：合并数据集时保留所有行，不去除重复
- **错误处理**：同样验证输入数据集列名是否匹配
- **执行流程**：获取输入数据集 → 验证列名 → 合并（不去重）→ 返回结果
- **单元测试**：验证基本功能、空数据集处理、保留重复行功能

### 5. intersect.rs

实现了 INTERSECT 操作，返回两个数据集的交集，包括：

- **IntersectExecutor**：INTERSECT 执行器，只返回同时存在于两个数据集中的行
- **交集逻辑**：创建右数据集的行哈希集合，遍历左数据集找出共同行
- **性能优化**：使用哈希集合实现 O(1) 时间复杂度的查找
- **边界处理**：处理任一数据集为空的情况
- **单元测试**：验证交集计算、空数据集、重复行处理等场景

### 6. minus.rs

实现了 MINUS 操作（或 EXCEPT），返回左数据集中存在但右数据集中不存在的行，包括：

- **MinusExecutor**：MINUS 执行器，实现 SQL MINUS/EXCEPT 类似的功能
- **差集逻辑**：创建右数据集的行哈希集合，过滤左数据集中的行
- **性能优化**：使用哈希集合实现 O(1) 时间复杂度的查找
- **边界处理**：处理左右数据集为空的情况
- **单元测试**：验证差集计算、边界情况和重复行处理

## 设计理念

集合运算模块遵循以下设计理念：

- **抽象基类**：通过 SetExecutor 基类提供公共功能和接口
- **哈希优化**：使用哈希方法优化重复行检测和行查找性能
- **列名验证**：确保操作的数据集具有兼容的列结构
- **内存效率**：采用适当的数据结构以优化内存使用
- **错误处理**：对无效输入和不兼容操作进行适当的错误处理
- **一致性**：所有实现都保持 SQL 集合操作的行为语义