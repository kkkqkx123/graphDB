# JOIN 执行器模块

本目录包含所有 JOIN 操作相关的执行器实现，用于处理数据集之间的关联操作。

## 文件说明

### 1. mod.rs

这是 JOIN 执行器模块的入口文件，定义了公共接口和可导出的类型。它包含了：

- **模块声明**：声明了 `base_join`、`cross_join`、`hash_table`、`inner_join`、`left_join` 和 `parallel` 子模块
- **公共类型导出**：导出了各种 JOIN 执行器类型及相关的操作枚举
- **JOIN 类型枚举**：定义了 `JoinType` 枚举，包括 `Inner`（内连接）、`Left`（左外连接）、`Right`（右外连接-未实现）、`Full`（全外连接-未实现）和 `Cross`（笛卡尔积）
- **配置结构**：定义了 `JoinConfig` 结构体，用于配置 JOIN 操作的各种参数
- **工厂模式**：提供了 `JoinExecutorFactory` 结构体，用于创建不同类型 JOIN 执行器的实例
- **单元测试**：包含了配置创建和工厂模式的基本功能测试

### 2. base_join.rs

实现了 JOIN 执行器的基础结构和公共功能，包括：

- **BaseJoinExecutor**：JOIN 操作的基础执行器结构，包含输入变量、连接键表达式、输出列等公共属性
- **输入数据集处理**：提供了检查和获取左右输入数据集的方法
- **哈希表构建**：实现了单键和多键哈希表的构建方法
- **结果行创建**：提供了连接左右两行数据的方法
- **优化方法**：包含决定是否交换左右输入以优化性能的逻辑
- **JOIN 操作 trait**：定义了 `JoinOperation` 通用 trait 及其具体实现（内连接、左连接、笛卡尔积）

### 3. hash_table.rs

实现了 JOIN 操作所需的哈希表数据结构，包括：

- **JoinKey**：JOIN 键的表示，支持多键连接，实现了哈希和相等比较
- **哈希表类型别名**：定义了 `SingleKeyHashTable` 和 `MultiKeyHashTable` 类型别名
- **哈希表构建器**：`HashTableBuilder` 结构体提供了构建单键和多键哈希表的方法
- **哈希表探测器**：`HashTableProbe` 结构体提供了单键和多键的探测方法
- **统计信息**：`HashTableStats` 结构体提供了计算哈希表统计信息的方法
- **单元测试**：验证哈希表构建和探测功能

### 4. inner_join.rs

实现了基于哈希的内连接算法，支持单键和多键连接，包括：

- **InnerJoinExecutor**：内连接执行器，支持单键和多键连接
- **单键连接**：实现了基于单键的哈希连接算法，包括构建和探测步骤
- **多键连接**：实现了基于多键的哈希连接算法
- **性能优化**：实现了交换左右输入以优化性能的逻辑（选择较小的表作为构建表）
- **并行版本**：提供了 `HashInnerJoinExecutor`，为未来的并行处理预留接口
- **单元测试**：验证单键连接和空表处理的功能

### 5. left_join.rs

实现了基于哈希的左外连接算法，支持单键和多键连接，包括：

- **LeftJoinExecutor**：左外连接执行器，保持左表的所有行
- **单键连接**：实现左外连接的单键算法，处理未匹配的左表行（填充NULL）
- **多键连接**：实现左外连接的多键算法
- **NULL 填充**：为未在右表中找到匹配的左表行提供 NULL 值填充
- **并行版本**：提供了 `HashLeftJoinExecutor`，为未来的并行处理预留接口
- **单元测试**：验证左外连接功能和空表处理

### 6. cross_join.rs

实现了笛卡尔积执行器，支持多表连接，包括：

- **CrossJoinExecutor**：笛卡尔积执行器，实现两表或多表的笛卡尔积运算
- **两表笛卡尔积**：实现了基本的两表笛卡尔积算法
- **多表笛卡尔积**：实现了支持多表的笛卡尔积运算
- **优化实现**：提供了递归生成笛卡尔积的优化实现
- **内存管理**：考虑了大数据集时的内存使用情况
- **单元测试**：验证两表和多表笛卡尔积功能

### 7. parallel.rs

提供了并行化的 JOIN 算法，利用多核 CPU 提升性能，包括：

- **并行配置**：`ParallelConfig` 结构体定义了并行处理的配置参数（线程数、最小行数等）
- **并行哈希表构建**：`ParallelHashTableBuilder` 实现了并行构建单键和多键哈希表
- **并行哈希表探测**：`ParallelHashTableProbe` 实现了并行探测功能
- **并行笛卡尔积**：`ParallelCartesianProduct` 实现了并行的笛卡尔积计算
- **工作窃取队列**：`WorkStealingQueue` 实现了负载均衡的队列
- **单元测试**：验证并行处理功能

## 设计理念

JOIN 模块遵循以下设计理念：

- **模块化设计**：每个功能模块职责单一，易于维护和扩展
- **性能优化**：使用哈希表优化连接性能，选择较小的表作为构建表
- **并行处理**：支持多核环境下的并行处理，提升大数据集处理性能
- **内存管理**：考虑大数据集时的内存使用，提供相应的优化策略
- **错误处理**：对各种边界情况和错误条件进行适当处理
- **类型安全**：利用 Rust 的类型系统保证操作的安全性