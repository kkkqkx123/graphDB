# 数据处理执行器模块

本目录包含所有与数据处理相关的执行器实现，这些执行器负责处理中间结果的转换和处理。

## 模块说明

### 1. mod.rs

这是数据处理执行器模块的入口文件，定义了公共接口和可导出的类型。它包含了：

- **模块声明**：声明了 `filter`、`graph_traversal`、`set_operations`、`join`、`transformations` 和 `loops` 子模块
- **公共类型导出**：导出了各种数据处理执行器类型
- **模块组织**：按照功能将执行器分为条件过滤、图遍历、集合运算、JOIN操作、数据转换和循环控制

### 2. filter.rs

实现了条件过滤执行器，用于 WHERE 子句等场景，包括：

- **FilterExecutor**：基于指定条件对输入数据进行过滤的执行器
- **条件表达式**：使用表达式引擎评估过滤条件
- **多类型支持**：支持对值、顶点、边等不同类型的数据进行过滤
- **上下文构建**：为不同数据类型创建评估上下文，将对象属性作为变量提供给表达式
- **值到布尔转换**：实现将值转换为布尔值的逻辑（空值、零值转为 false）
- **单元测试**：验证过滤功能

### 3. dedup.rs

实现了去重执行器，支持多种去重策略，包括：

- **DedupStrategy 枚举**：定义了完全去重、基于键去重、基于顶点ID去重和基于边关键信息去重策略
- **DedupExecutor**：根据指定策略对数据进行去重的执行器
- **内存管理**：包含内存使用限制，防止大数据集去重时内存溢出
- **多类型支持**：支持对值、顶点、边等不同类型的数据进行去重
- **键提取**：实现从不同数据类型中提取键值的方法
- **单元测试**：验证不同去重策略

### 4. sample.rs

实现了采样执行器，支持多种采样算法，包括：

- **SampleMethod 枚举**：定义了随机采样、水库采样、系统采样和分层采样方法
- **SampleExecutor**：根据指定方法对数据进行采样的执行器
- **随机数生成**：支持可重现的随机采样（使用种子）
- **多类型支持**：支持对值、顶点、边、数据集等不同类型的数据进行采样
- **采样算法**：
  - 随机采样：使用 Fisher-Yates 洗牌算法
  - 水库采样：适用于流式数据的采样
  - 系统采样：等间隔采样
  - 分层采样：基于指定键的分层采样
- **单元测试**：验证不同采样算法

### 5. loops.rs

实现了循环控制执行器，支持条件循环和计数循环，包括：

- **LoopState 枚举**：定义了循环的状态（未开始、运行中、已完成、错误）
- **LoopExecutor**：实现循环控制逻辑的通用执行器
- **WhileLoopExecutor**：专门用于 WHILE 循环的执行器
- **ForLoopExecutor**：专门用于 FOR 循环的执行器
- **迭代控制**：支持最大迭代次数限制和条件评估
- **结果收集**：收集每次迭代的结果并合并
- **循环上下文**：维护循环变量和迭代计数器
- **单元测试**：验证循环功能

### 6. graph_traversal 目录

包含图遍历相关的执行器，如 Expand、Traverse、ShortestPath 等，已在相应目录的 README.md 中详细说明。

### 7. set_operations 目录

包含集合运算相关的执行器，如 Union、Intersect、Minus 等，已在相应目录的 README.md 中详细说明。

### 8. join 目录

包含 JOIN 操作相关的执行器，如 InnerJoin、LeftJoin 等，已在相应目录的 README.md 中详细说明。

### 9. transformations 目录

包含数据转换相关的执行器，如 Assign、Unwind、PatternApply 等，已在相应目录的 README.md 中详细说明。

## 设计理念

数据处理模块遵循以下设计理念：

- **模块化设计**：将不同功能的执行器放在独立的模块中，便于维护和扩展
- **表达式集成**：与表达式引擎深度集成，支持复杂的条件和计算
- **类型安全**：使用 Rust 的类型系统保证数据操作的安全性
- **内存效率**：考虑大数据处理时的内存使用和性能
- **错误处理**：对各种边界情况和错误条件进行适当处理
- **可扩展性**：设计灵活的接口和策略模式，便于添加新的算法和功能
- **一致性**：所有执行器保持一致的接口和行为模式