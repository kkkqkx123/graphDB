# 数据转换执行器模块

本目录包含所有数据转换相关的执行器实现，用于处理数据的变换、展开、赋值等操作。

## 文件说明

### 1. mod.rs

这是数据转换执行器模块的入口文件，定义了公共接口和可导出的类型。它包含了：

- **模块声明**：声明了 `assign`、`unwind`、`append_vertices`、`pattern_apply` 和 `rollup_apply` 子模块
- **公共类型导出**：导出了各种数据转换执行器类型及相关的枚举类型
- **功能分类**：将数据转换操作分为赋值（Assign）、列表展开（Unwind）、顶点追加（AppendVertices）、模式匹配（PatternApply）和聚合（RollUpApply）

### 2. assign.rs

实现了变量赋值操作，将表达式的结果赋值给变量，包括：

- **AssignExecutor**：用于将表达式的结果赋值给变量的执行器
- **表达式求值**：使用表达式引擎计算表达式的值
- **变量管理**：将计算结果设置到执行上下文和表达式上下文中
- **数据类型处理**：根据值的类型（如数据集）采用不同的处理方式
- **上下文管理**：支持带上下文的创建方式
- **单元测试**：验证基本赋值功能

### 3. unwind.rs

实现了列表展开操作，将列表中的每个元素展开为单独的行，包括：

- **UnwindExecutor**：用于将列表中的每个元素展开为单独行的执行器
- **值提取**：从 Value 中提取列表元素，支持多种数据类型
- **表达式上下文**：在展开过程中使用表达式上下文进行计算
- **输入处理**：支持多种输入结果类型（Values、Vertices、Edges、Paths、DataSet等）
- **管道处理**：区分来自管道的输入和非管道输入的处理方式
- **单元测试**：验证列表展开功能

### 4. append_vertices.rs

实现了追加顶点操作，根据给定的顶点 ID 获取顶点信息并追加到结果中，包括：

- **AppendVerticesExecutor**：根据顶点 ID 获取顶点信息并追加到结果的执行器
- **顶点 ID 提取**：从输入数据中提取顶点 ID
- **去重功能**：可选的顶点去重功能
- **属性获取**：从存储中获取顶点属性信息
- **过滤功能**：支持根据过滤表达式过滤顶点
- **路径跟踪**：可选的路径跟踪功能
- **单元测试**：验证顶点追加功能

### 5. pattern_apply.rs

实现了模式匹配操作，将输入数据与指定模式进行匹配，包括：

- **PatternType 枚举**：定义了节点模式（Node）、边模式（Edge）和路径模式（Path）
- **EdgeDirection 枚举**：定义了边的方向（出边、入边、无向边）
- **PatternApplyExecutor**：将输入数据与指定模式进行匹配的执行器
- **节点匹配**：检查顶点是否匹配节点模式（标签、属性条件）
- **边匹配**：检查边是否匹配边模式（类型、方向、属性条件）
- **路径匹配**：检查路径是否匹配路径模式（长度范围）
- **表达式评估**：使用表达式引擎评估属性条件
- **单元测试**：验证节点模式匹配功能

### 6. rollup_apply.rs

实现了聚合操作，将右输入中的值根据左输入的键进行聚合，包括：

- **RollUpApplyExecutor**：将右输入中的值根据左输入的键进行聚合的执行器
- **多键支持**：支持零键、单键和多键的聚合操作
- **哈希表构建**：构建用于聚合的哈希表结构
- **探测功能**：根据左输入的键在右输入构建的哈希表中进行探测
- **多种输入类型**：支持多种输入结果类型的处理（Values、Vertices、Edges）
- **列表收集**：将匹配的值收集为列表输出
- **单元测试**：验证聚合功能

## 设计理念

数据转换模块遵循以下设计理念：

- **表达式集成**：与表达式引擎深度集成，支持复杂的表达式计算
- **类型安全**：使用 Rust 的类型系统保证数据操作的安全性
- **灵活输入**：支持多种输入结果类型，提供统一的处理接口
- **上下文管理**：维护执行上下文，支持变量和结果的传递
- **内存效率**：考虑大数据集处理时的内存使用效率
- **错误处理**：对各种边界情况和错误条件进行适当处理
- **模块化设计**：每个转换器职责单一，易于维护和扩展