# 验证上下文模块 (Validate Context Module)

## 概述

验证上下文模块是 GraphDB 查询验证阶段的核心组件，负责在查询执行前对查询语句进行验证，确保查询的语义正确性。该模块提供了在验证过程中所需的上下文信息管理和相关工具。

## 文件结构及功能说明

### 1. `types.rs` - 基础数据类型定义

定义了验证上下文中使用的所有基础数据结构：

- **SpaceInfo**: 表示图空间的基本信息，包括ID、名称和顶点ID类型
- **Column**: 表示列定义，包含列名和类型
- **ColsDef**: 列定义集合，别名为 Vec<Column>
- **Variable**: 表示查询中定义的变量（如MATCH子句中的别名），包含变量名和关联的列定义

这些类型为整个验证上下文系统提供了统一的数据格式。

### 2. `basic_context.rs` - 基本验证上下文

实现了验证阶段的基础上下文管理功能，主要包括：

- **图空间管理**: 跟踪当前图空间的切换和选择状态
- **变量管理**: 管理查询中定义的变量（如MATCH子句中的别名）和它们的类型信息
- **参数管理**: 存储和检索查询参数
- **别名管理**: 维护别名到类型的映射关系
- **错误管理**: 收集和报告验证过程中发现的错误
- **元数据管理**: 追踪待创建的空间、索引等信息

### 3. `schema.rs` - Schema管理

提供了数据库Schema的管理和验证功能，包含以下组件：

- **SchemaProvider Trait**: 定义了Schema访问的通用接口
- **SchemaInfo**: 存储Schema信息，包括名称、字段及其类型
- **SchemaManager**: 实现了Schema管理功能的具体实现

这个模块允许验证过程检查查询中使用的字段是否存在于相关的Schema中。

### 4. `generators.rs` - 匿名生成器

提供了生成唯一标识符的功能，包括：

- **AnonVarGenerator**: 匿名变量名生成器，用于自动创建唯一的变量名
- **AnonColGenerator**: 匿名列名生成器，用于自动创建唯一的列名
- **GeneratorFactory**: 生成器的工厂类，提供默认和自定义的生成器实例

这些生成器保证了在查询处理过程中能够安全地创建不冲突的标识符，具有线程安全性。

### 5. `context.rs` - 增强验证上下文

集成了所有验证功能的高级上下文类，继承了BasicValidateContext的所有功能，并增加了：

- **Schema管理集成**: 集成了Schema验证功能
- **生成器集成**: 集成了匿名变量和列生成器
- **符号表集成**: 集成了符号表管理功能
- **组合管理**: 将所有验证子系统整合在一起

### 6. `mod.rs` - 模块组织和公共接口

此文件定义了整个验证上下文模块的公共接口，通过重新导出关键类型使外部代码可以方便地访问模块功能。还包含：

- **版本信息**: 定义了验证上下文的版本
- **功能特性**: 提供了模块功能的查询接口

## 设计特点

1. **模块化设计**: 功能按职责拆分到不同的模块，提高了代码的可维护性和可测试性
2. **线程安全**: 使用适当的并发原语确保多线程环境下的安全性
3. **可扩展性**: 通过Trait定义接口，便于扩展和替换具体实现
4. **统一接口**: BasicValidateContext和ValidateContext提供统一的操作接口，后者在此基础上增加更多功能

## 使用场景

- 查询语法和语义验证
- 图空间访问权限校验
- 变量作用域检查
- Schema兼容性验证
- 验证错误收集和报告

## 注意事项

- 所有代码均使用简体中文编写
- 遵循Rust编码规范和最佳实践
- 包含完整的单元测试，确保功能正确性
- 模块具备良好的性能表现，适用于高频查询验证场景